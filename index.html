<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Dashboard - Get in the Game Show</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @keyframes quickFlash {
            0% { opacity: 0; transform: scale(0.2); }
            35% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        @keyframes buzzer-glow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 193, 7, 0.4); }
            50% { box-shadow: 0 0 50px rgba(255, 193, 7, 0.8); }
        }
        @keyframes buzzer-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        @keyframes confetti {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
        @keyframes float-up {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
        }
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(20, 184, 166, 0.4); }
        }
        .sparkle {
            animation: quickFlash 0.25s ease-out;
            pointer-events: none;
        }
        .logo-glow {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }
        .buzzer-glow {
            animation: buzzer-glow 2s ease-in-out infinite, buzzer-pulse 3s ease-in-out infinite;
        }
        .confetti-piece {
            position: absolute;
            animation: confetti 3s linear infinite;
            z-index: 1000;
        }
        .party-emoji {
            position: absolute;
            animation: float-up 4s ease-out forwards;
            z-index: 100;
        }
        .celebration-text {
            animation: glow-pulse 2s ease-in-out infinite;
        }
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 50%, #1e1b4b 100%);
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <div id="app" class="relative min-h-screen overflow-hidden">
        <!-- Sparkles Container -->
        <div id="sparkles"></div>
        
        <!-- Entry Screen -->
        <div id="entryScreen" class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="mb-8 text-center">
                <img
                    src="logo.png"
                    alt="Get in the Game Show Logo"
                    class="logo-glow w-48 h-24 mx-auto mb-4 object-contain rounded-2xl shadow-2xl"
                    onerror="this.style.display='none'"
                />
                <div class="text-white text-3xl font-bold mb-2">‚ö° GET EXCITED ‚ö°</div>
            </div>
            
            <div class="w-full max-w-sm">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                    <div class="text-white text-lg font-medium mb-6 text-center">Ready to play?</div>
                    <div class="space-y-4">
                        <div>
                            <input
                                type="text"
                                id="gameCodeInput"
                                class="w-full p-4 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 text-center text-2xl font-bold uppercase tracking-wider"
                                placeholder="Enter 6-digit code"
                                maxlength="6"
                            />
                        </div>
                        <button
                            id="joinGameBtn"
                            class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-6 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg opacity-50 cursor-not-allowed"
                            disabled
                        >
                            JOIN GAME üöÄ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Team Setup Screen -->
        <div id="teamSetupScreen" class="min-h-screen flex flex-col items-center justify-center p-4" style="display: none;">
            <div class="mb-8 text-center">
                <img
                    src="logo.png"
                    alt="Get in the Game Show Logo"
                    class="logo-glow w-48 h-24 mx-auto mb-4 object-contain rounded-xl shadow-xl"
                    onerror="this.style.display='none'"
                />
                <div class="text-white text-2xl font-bold">üë• Team Setup</div>
            </div>

            <div class="w-full max-w-sm">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                    <div class="space-y-4">
                        <div>
                            <input
                                type="text"
                                id="teamNameInput"
                                class="w-full p-4 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/60 text-center text-lg"
                                placeholder="Enter your team name"
                                maxlength="40"
                            />
                            <div class="text-right text-white/60 text-sm mt-2">
                                <span id="charCount">0</span>/40 characters
                            </div>
                        </div>
                        <button
                            id="submitTeamBtn"
                            class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-6 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg opacity-50 cursor-not-allowed"
                            disabled
                        >
                            LET'S PLAY! üöÄ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div id="dashboardScreen" class="min-h-screen flex flex-col p-2" style="display: none;">
            <!-- Header -->
            <div class="text-center mb-4">
                <img
                    src="logo.png"
                    alt="Get in the Game Show Logo"
                    class="logo-glow w-48 h-24 mx-auto mb-2 object-contain rounded-xl shadow-xl"
                    onerror="this.style.display='none'"
                />
                <h1 class="text-2xl font-bold text-white">‚ö° TEAM DASHBOARD ‚ö°</h1>
            </div>

            <!-- Team Info Box -->
            <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-4 mb-4 shadow-2xl">
                <div class="text-center">
                    <div class="text-white text-sm font-bold mb-1">TEAM</div>
                    <h2 id="teamNameDisplay" class="text-xl font-bold text-white mb-1">‚≠ê Team Name ‚≠ê</h2>
                    <p class="text-white text-lg mb-3 font-bold">are here to PLAY! ü•≥</p>
                    <div class="flex space-x-3">
                        <button
                            id="cheerBtn"
                            class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white border-2 border-purple-400 font-bold py-2 px-3 rounded-lg transition-all transform hover:scale-95 shadow-lg text-sm"
                        >
                            Cheer üéâ
                        </button>
                        <button
                            id="exitGameBtn"
                            class="flex-1 bg-gradient-to-r from-pink-600 to-purple-600 text-white border-2 border-pink-400 font-bold py-2 px-3 rounded-lg shadow-lg text-sm transition-all transform hover:scale-95"
                        >
                            üö™ EXIT
                        </button>
                    </div>
                </div>
            </div>

            <!-- Giant 3D Buzzer Button -->
            <div id="buzzerSection" class="flex-1 flex items-center justify-center mb-4">
                <button
                    id="buzzerBtn"
                    class="buzzer-glow w-11/12 aspect-square max-w-sm rounded-full text-center font-bold bg-gradient-to-b from-yellow-400 via-yellow-500 to-yellow-600 text-blue-900 relative shadow-2xl"
                >
                    <div class="flex flex-col items-center justify-center h-full relative z-10">
                        <div class="text-lg leading-tight mb-1 font-black">GET READY TO</div>
                        <div class="text-lg leading-tight mb-3 font-black">GET IN THE GAME!</div>
                        <div class="text-6xl mb-2">üö®</div>
                        <div class="text-2xl font-black">TAP TO BUZZ!</div>
                    </div>
                    <!-- 3D Button Effect Ring -->
                    <div class="absolute inset-2 rounded-full bg-gradient-to-b from-yellow-300 to-yellow-400 opacity-30"></div>
                    <div class="absolute inset-4 rounded-full bg-gradient-to-b from-yellow-200 to-yellow-300 opacity-20"></div>
                </button>
            </div>

            <!-- Bottom Message -->
            <div id="bottomSection" class="text-center bg-white/10 backdrop-blur-md border border-cyan-400/60 rounded-2xl p-3 shadow-lg">
                <div class="text-white text-sm leading-relaxed">
                    üíé <strong>Scan QR code on the scoresheet to join our Frequent Fun Program and earn rewards just for playing!</strong> üíé
                </div>
            </div>
        </div>

        <!-- Celebration Screen -->
        <div id="celebrationScreen" class="min-h-screen flex flex-col items-center justify-center p-4" style="display: none;">
            <div id="confettiContainer"></div>
            
            <div class="text-center space-y-6">
                <img
                    src="logo.png"
                    alt="Get in the Game Show Logo"
                    class="logo-glow w-48 h-24 mx-auto object-contain rounded-xl shadow-xl"
                    onerror="this.style.display='none'"
                />
                
                <div id="placementMessage" class="text-4xl font-bold text-white celebration-text mb-6">
                    üéâ You got 1st place! üéâ
                </div>
                
                <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6 celebration-text">
                    <div class="text-2xl font-bold text-white mb-4">
                        You just earned 1000 sMiles! ü§©
                    </div>
                    <div class="text-lg text-white">
                        Scan QR code on scoresheet to join Frequent Fun Program and earn your first gift instantly! üéÅ
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://tqpuxtswcuwruaqhompl.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxcHV4dHN3Y3V3cnVhcWhvbXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NDUyMjQsImV4cCI6MjA3MzEyMTIyNH0.JF71Ap_FJG872iApuXaKW-vNN5TWPiJXvmz6PXWm4cU';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Game state
        let currentScreen = 'entry';
        let gameCode = '';
        let teamName = '';
        let teamId = null;
        let gameId = null;
        let isBuzzed = false;
        let realtimeChannel = null;

        // Reconnection strategy using localStorage
        const STORAGE_KEY = 'buzzer_game_state';
        const STORAGE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours

        function saveGameState() {
            const state = {
                gameCode,
                teamName,
                gameId,
                teamId,
                isBuzzed,
                timestamp: Date.now()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function loadGameState() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (!saved) return null;

                const state = JSON.parse(saved);
                if (Date.now() - state.timestamp > STORAGE_EXPIRY) {
                    localStorage.removeItem(STORAGE_KEY);
                    return null;
                }
                return state;
            } catch (e) {
                localStorage.removeItem(STORAGE_KEY);
                return null;
            }
        }

        function clearGameState() {
            localStorage.removeItem(STORAGE_KEY);
        }

        // Sparkle effect
        function createSparkle() {
            const shapes = ['‚ú¶', '‚Ä¢', '¬∑', '*', '‚úß', '‚ãÜ', '‚ó¶'];
            const sparklesContainer = document.getElementById('sparkles');
            for(let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.position = 'absolute';
                    sparkle.style.left = (Math.random() * 90 + 5) + '%';
                    sparkle.style.top = (Math.random() * 90 + 5) + '%';
                    sparkle.style.color = 'white';
                    sparkle.style.fontSize = (Math.random() < 0.4 ? 6 : Math.random() < 0.7 ? 10 : 14) + 'px';
                    sparkle.style.textShadow = '0 0 4px rgba(255,255,255,0.8)';
                    sparkle.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                    sparkle.style.zIndex = '5';
                    sparklesContainer.appendChild(sparkle);
                    setTimeout(() => {
                        sparkle.remove();
                    }, 250);
                }, i * 50);
            }
        }
        setInterval(createSparkle, 100);

        // Screen management
        function showScreen(screen) {
            document.getElementById('entryScreen').style.display = 'none';
            document.getElementById('teamSetupScreen').style.display = 'none';
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('celebrationScreen').style.display = 'none';

            if (screen === 'entry') {
                document.getElementById('entryScreen').style.display = 'flex';
            } else if (screen === 'teamSetup') {
                document.getElementById('teamSetupScreen').style.display = 'flex';
            } else if (screen === 'dashboard') {
                document.getElementById('dashboardScreen').style.display = 'flex';
            } else if (screen === 'celebration') {
                document.getElementById('celebrationScreen').style.display = 'flex';
            }
            currentScreen = screen;
        }

        // Audio functions
        function playBuzzerSound() {
            try {
                new Audio('buzzer.mp3').play().catch(() => {});
            } catch (e) {}
        }

        function playClappingSound() {
            try {
                new Audio('clapping.mp3').play().catch(() => {});
            } catch (e) {}
        }

        function playFanfareSound() {
            try {
                new Audio('fanfare.mp3').play().catch(() => {});
            } catch (e) {}
        }

        // Party effects
        function createPartyEmojis() {
            const emojis = ['üéâ', 'üéä', 'ü•≥', 'üéà', '‚ú®', 'üåü', 'üí´', 'üéÜ'];
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'party-emoji';
                    emoji.style.position = 'absolute';
                    emoji.style.left = Math.random() * 100 + '%';
                    emoji.style.bottom = '0px';
                    emoji.style.fontSize = '24px';
                    emoji.style.zIndex = '100';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    document.body.appendChild(emoji);
                    setTimeout(() => emoji.remove(), 4000);
                }, i * 200);
            }
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    document.getElementById('confettiContainer').appendChild(confetti);
                    setTimeout(() => confetti.remove(), 8000);
                }, i * 50);
            }
        }

        // Supabase functions
        async function validateGameCode(code) {
            const { data, error } = await supabase
                .from('games')
                .select('id')
                .eq('game_code', code)
                .eq('status', 'active')
                .single();

            if (error || !data) {
                return null;
            }
            return data.id;
        }

        async function attemptReconnection() {
            const savedState = loadGameState();
            if (!savedState) return false;

            // Validate game still exists and is active
            const validGameId = await validateGameCode(savedState.gameCode);
            if (!validGameId) {
                clearGameState();
                return false;
            }

            // Check if team still exists in game
            const { data: existingTeam } = await supabase
                .from('teams')
                .select('*')
                .eq('game_id', validGameId)
                .eq('name', savedState.teamName)
                .single();

            if (existingTeam) {
                // Reconnect with existing team
                gameCode = savedState.gameCode;
                teamName = savedState.teamName;
                gameId = validGameId;
                teamId = existingTeam.id;
                isBuzzed = !!existingTeam.buzzed_at;

                document.getElementById('teamNameDisplay').textContent = `‚≠ê ${teamName} ‚≠ê`;
                
                if (isBuzzed) {
                    setBuzzerToBuzzedState();
                }

                setupRealtime();
                showScreen('dashboard');
                return true;
            }

            clearGameState();
            return false;
        }

        async function joinGame(code, name) {
            const validGameId = await validateGameCode(code);
            if (!validGameId) {
                alert('Invalid game code or game not active!');
                return false;
            }

            // Check if team name already exists in this game
            const { data: existingTeam } = await supabase
                .from('teams')
                .select('id')
                .eq('game_id', validGameId)
                .eq('name', name)
                .single();

            if (existingTeam) {
                alert('Team name already taken in this game!');
                return false;
            }

            // Create new team
            const { data, error } = await supabase
                .from('teams')
                .insert([{
                    game_id: validGameId,
                    name: name,
                    created_at: new Date().toISOString()
                }])
                .select()
                .single();

            if (error) {
                console.error('Error joining game:', error);
                alert('Error joining game. Please try again.');
                return false;
            }

            gameId = validGameId;
            teamId = data.id;
            saveGameState();
            return true;
        }

        async function buzzIn() {
            if (!teamId || isBuzzed) return false;

            const { error } = await supabase
                .from('teams')
                .update({
                    buzzed_at: new Date().toISOString()
                })
                .eq('id', teamId);

            if (error) {
                console.error('Error buzzing in:', error);
                return false;
            }

            return true;
        }

        function setBuzzerToBuzzedState() {
            const buzzer = document.getElementById('buzzerBtn');
            buzzer.className = 'w-11/12 aspect-square max-w-sm rounded-full text-center font-bold bg-gradient-to-b from-green-400 via-green-500 to-green-600 text-white relative shadow-2xl';
            buzzer.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full relative z-10">
                    <div class="text-2xl mb-3">üî• YOU'RE IN! üî•</div>
                    <div class="text-lg leading-tight mb-2">WAIT FOR HOST</div>
                    <div class="text-lg leading-tight">TO CALL ON YOU</div>
                    <div class="text-4xl mt-3 animate-pulse">‚ö°</div>
                </div>
                <div class="absolute inset-2 rounded-full bg-gradient-to-b from-green-300 to-green-400 opacity-30"></div>
                <div class="absolute inset-4 rounded-full bg-gradient-to-b from-green-200 to-green-300 opacity-20"></div>
            `;
        }

        function resetBuzzerToReady() {
            const buzzer = document.getElementById('buzzerBtn');
            buzzer.className = 'buzzer-glow w-11/12 aspect-square max-w-sm rounded-full text-center font-bold bg-gradient-to-b from-yellow-400 via-yellow-500 to-yellow-600 text-blue-900 relative shadow-2xl';
            buzzer.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full relative z-10">
                    <div class="text-lg leading-tight mb-1 font-black">GET READY TO</div>
                    <div class="text-lg leading-tight mb-3 font-black">GET IN THE GAME!</div>
                    <div class="text-6xl mb-2">üö®</div>
                    <div class="text-2xl font-black">TAP TO BUZZ!</div>
                </div>
                <div class="absolute inset-2 rounded-full bg-gradient-to-b from-yellow-300 to-yellow-400 opacity-30"></div>
                <div class="absolute inset-4 rounded-full bg-gradient-to-b from-yellow-200 to-yellow-300 opacity-20"></div>
            `;
        }

        // Setup real-time subscriptions
        function setupRealtime() {
            if (realtimeChannel) {
                supabase.removeChannel(realtimeChannel);
            }

            realtimeChannel = supabase
                .channel(`player_${teamId}`)
                .on('postgres_changes',
                    { event: 'UPDATE', schema: 'public', table: 'teams', filter: `id=eq.${teamId}` },
                    (payload) => {
                        console.log('Team update:', payload);
                        const newData = payload.new;
                        
                        // Handle buzzer clear
                        if (!newData.buzzed_at && isBuzzed) {
                            isBuzzed = false;
                            resetBuzzerToReady();
                            saveGameState();
                        }
                    }
                )
                .on('postgres_changes',
                    { event: 'UPDATE', schema: 'public', table: 'games', filter: `id=eq.${gameId}` },
                    (payload) => {
                        console.log('Game update:', payload);
                        const newData = payload.new;
                        
                        // Handle score reveal
                        if (newData.status === 'scores_revealed' && newData.scores_data) {
                            const placements = JSON.parse(newData.scores_data);
                            const myPlacement = placements[teamId];
                            
                            if (myPlacement) {
                                showCelebration(myPlacement);
                            }
                        }
                        
                        // Handle game end
                        if (newData.status === 'ended') {
                            alert('Game has ended by the host.');
                            exitGame();
                        }
                    }
                )
                .subscribe();
        }

        function showCelebration(placement) {
            const { place, isTie } = placement;
            let message;
            
            if (isTie) {
                message = `üéâ It's a Tie! You Got ${getOrdinal(place)} Place! üéâ`;
            } else {
                message = `üéâ You got ${getOrdinal(place)} place! üéâ`;
            }
            
            document.getElementById('placementMessage').textContent = message;
            
            // Play fanfare and create effects
            playFanfareSound();
            createConfetti();
            
            showScreen('celebration');
        }

        function getOrdinal(num) {
            const suffixes = ['th', 'st', 'nd', 'rd'];
            const v = num % 100;
            return num + (suffixes[(v - 20) % 10] || suffixes[v] || suffixes[0]);
        }

        function exitGame() {
            // Cleanup
            if (realtimeChannel) {
                supabase.removeChannel(realtimeChannel);
            }
            
            clearGameState();
            gameCode = '';
            teamName = '';
            teamId = null;
            gameId = null;
            isBuzzed = false;
            
            // Reset forms
            document.getElementById('gameCodeInput').value = '';
            document.getElementById('teamNameInput').value = '';
            document.getElementById('charCount').textContent = '0';
            
            showScreen('entry');
        }

        // Game code validation
        function isValidGameCodeFormat(code) {
            return /^\d{6}$/.test(code);
        }

        // Event listeners
        document.getElementById('gameCodeInput').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '').slice(0, 6);
            e.target.value = value;
            gameCode = value;

            const joinBtn = document.getElementById('joinGameBtn');
            if (value.length === 6 && isValidGameCodeFormat(value)) {
                joinBtn.disabled = false;
                joinBtn.className = 'w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-6 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg';
            } else {
                joinBtn.disabled = true;
                joinBtn.className = 'w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-6 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg opacity-50 cursor-not-allowed';
            }
        });

        document.getElementById('joinGameBtn').addEventListener('click', async function() {
            if (gameCode.length === 6 && isValidGameCodeFormat(gameCode)) {
                const validGameId = await validateGameCode(gameCode);
                if (validGameId) {
                    showScreen('teamSetup');
                } else {
                    alert('Invalid game code or game not active!');
                }
            }
        });

        document.getElementById('teamNameInput').addEventListener('input', function(e) {
            const value = e.target.value.slice(0, 40);
            e.target.value = value;
            teamName = value;
            document.getElementById('charCount').textContent = value.length;

            const submitBtn = document.getElementById('submitTeamBtn');
            if (value.trim().length >= 2) {
                submitBtn.disabled = false;
                submitBtn.className = 'w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-6 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg';
            } else {
                submitBtn.disabled = true;
                submitBtn.className = 'w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold py-4 px-6 rounded-xl text-xl hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-200 shadow-lg opacity-50 cursor-not-allowed';
            }
        });

        document.getElementById('submitTeamBtn').addEventListener('click', async function() {
            if (teamName.trim().length >= 2) {
                const success = await joinGame(gameCode, teamName.trim());
                if (success) {
                    document.getElementById('teamNameDisplay').textContent = `‚≠ê ${teamName} ‚≠ê`;
                    setupRealtime();
                    showScreen('dashboard');
                }
            }
        });

        document.getElementById('buzzerBtn').addEventListener('click', async function() {
            if (!isBuzzed) {
                const success = await buzzIn();
                if (success) {
                    isBuzzed = true;
                    playBuzzerSound();
                    setBuzzerToBuzzedState();
                    saveGameState();

                    // Add success vibration if supported
                    if ('vibrate' in navigator) {
                        navigator.vibrate([100, 50, 100]);
                    }
                }
            }
        });

        document.getElementById('cheerBtn').addEventListener('click', function() {
            playClappingSound();
            createPartyEmojis();
        });

        document.getElementById('exitGameBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to leave the game?')) {
                exitGame();
            }
        });

        // Keyboard support for accessibility
        document.addEventListener('keydown', function(e) {
            if (currentScreen === 'dashboard' && (e.key === ' ' || e.key === 'Enter')) {
                e.preventDefault();
                document.getElementById('buzzerBtn').click();
            }
        });

        // Prevent zoom on double tap for mobile
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Initialize app - try reconnection first
        window.addEventListener('load', async function() {
            const reconnected = await attemptReconnection();
            if (!reconnected) {
                showScreen('entry');
            }
        });
    </script>
</body>
</html>
