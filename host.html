<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Host Dashboard - Get in the Game Show</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
@keyframes quickFlash {
0% { opacity: 0; transform: scale(0.2); }
35% { opacity: 1; transform: scale(1.1); }
100% { opacity: 0; transform: scale(0.5); }
}

@keyframes pulse-glow {
0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.6), 0 0 40px rgba(20, 184, 166, 0.4); }
}

@keyframes border-glow {
0%, 100% { border-color: #facc15; box-shadow: 0 0 15px rgba(250, 204, 21, 0.3); }
50% { border-color: #fde047; box-shadow: 0 0 25px rgba(250, 204, 21, 0.6), 0 0 35px rgba(253, 224, 71, 0.4); }
}

@keyframes glassmorphism-float {
0%, 100% { transform: translateY(0px); }
50% { transform: translateY(-2px); }
}

@keyframes skeleton-pulse {
0%, 100% { opacity: 0.4; }
50% { opacity: 0.8; }
}

.sparkle {
animation: quickFlash 0.25s ease-out;
pointer-events: none;
}

.logo-glow {
filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
}

.game-code-glow {
animation: pulse-glow 2s ease-in-out infinite, border-glow 3s ease-in-out infinite;
backdrop-filter: blur(10px);
background: rgba(147, 51, 234, 0.15);
}

.glassmorphism {
backdrop-filter: blur(16px) saturate(180%);
background: rgba(147, 51, 234, 0.1);
border: 1px solid rgba(255, 255, 255, 0.125);
animation: glassmorphism-float 4s ease-in-out infinite;
}

.button-hover {
transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.button-hover:hover {
transform: translateY(-1px) scale(1.02);
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.button-hover:active {
transform: translateY(1px) scale(0.98);
}

.team-card {
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.team-card:hover {
transform: translateY(-2px) scale(1.01);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.magenta-button {
background: linear-gradient(135deg, #cb0cea 0%, #a855f7 100%);
border-color: #cb0cea;
color: white;
}

.magenta-button:hover {
background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
}

body {
background: linear-gradient(135deg, #1e3a8a 0%, #312e81 50%, #1e1b4b 100%);
margin: 0;
font-family: 'Inter', system-ui, -apple-system, sans-serif;
}
</style>
</head>
<body>
<div id="app" class="relative min-h-screen w-full max-w-md mx-auto overflow-hidden">
<!-- Sparkles Container -->
<div id="sparkles"></div>

<!-- Main Content -->
<div class="relative z-10 p-4 space-y-4">
<!-- Header Section -->
<div class="text-center">
<img
src="logo.png"
alt="Get in the Game Show Logo"
class="logo-glow max-w-16 max-h-16 mx-auto mb-2 rounded-lg shadow-lg"
onerror="this.style.display='none'"
/>
<h1 class="text-xl font-bold text-white mb-3 tracking-wider">üéØ HOST DASHBOARD üéØ</h1>

<!-- Game Code Display -->
<div id="gameCodeSection" style="display: none;">
<div class="bg-gradient-to-r from-purple-800 to-purple-900 border-4 border-yellow-400 rounded-xl p-4 mb-3 game-code-glow glassmorphism">
<div class="text-yellow-400 font-bold text-sm mb-1">üéÆ GAME CODE üéÆ</div>
<div id="gameCodeDisplay" class="text-white font-bold text-4xl tracking-widest font-mono">-----</div>
</div>
</div>

<!-- Create Game Button -->
<div id="createGameSection">
<button
id="createGameBtn"
class="w-full py-4 px-4 text-lg font-bold rounded-xl border-4 border-yellow-400 shadow-2xl transition-all transform bg-cyan-400 text-blue-900 button-hover"
>
üöÄ CREATE NEW GAME üöÄ
</button>
</div>
</div>

<!-- Game Active Sections -->
<div id="gameActiveSections" style="display: none;">
<!-- Buzzed In Section -->
<div class="glassmorphism bg-gradient-to-r from-purple-800 to-purple-900 border-4 border-yellow-400 rounded-xl p-4 shadow-2xl">
<div class="flex justify-between items-center mb-3">
<h2 class="text-yellow-400 font-bold text-lg">‚ö° BUZZED IN ‚ö°</h2>
<button
id="clearAllBtn"
class="magenta-button font-bold py-2 px-4 rounded-lg text-sm button-hover transition-all transform shadow-lg border-2"
>
üßπ CLEAR ALL
</button>
</div>
<div id="buzzedTeamsList">
<div class="text-purple-200 text-center py-4 italic">No teams buzzed in yet...</div>
</div>
</div>

<!-- All Teams Section -->
<div class="glassmorphism bg-gradient-to-r from-purple-800 to-purple-900 border-4 border-yellow-400 rounded-xl p-4 shadow-2xl">
<h2 class="text-yellow-400 font-bold text-lg mb-3">üë• ALL TEAMS (<span id="teamCount">0</span>) üë•</h2>
<div id="allTeamsList">
<div class="text-purple-200 text-center py-4 italic">No teams joined yet...</div>
</div>
</div>

<!-- Scoring Section -->
<div class="glassmorphism bg-gradient-to-r from-purple-800 to-purple-900 border-4 border-yellow-400 rounded-xl p-4 shadow-2xl">
<h2 class="text-yellow-400 font-bold text-lg mb-3">üèÜ SCORING üèÜ</h2>
<div id="scoringList" class="space-y-2 max-h-64 overflow-y-auto">
<div class="text-purple-200 text-center py-4 italic">No teams to score yet...</div>
</div>

<!-- Dramatic Reading Order -->
<div id="dramaticReadingSection" style="display: none;" class="mt-4 pt-4 border-t-2 border-yellow-400">
<h3 class="text-yellow-400 font-bold text-sm mb-2">üé≠ PLACEMENT ORDER (LOW TO HIGH) üé≠</h3>
<div id="dramaticReadingList" class="space-y-1"></div>
</div>

<button
id="revealScoresBtn"
class="w-full mt-4 py-3 px-4 text-lg font-bold rounded-xl border-4 border-yellow-400 shadow-2xl transition-all transform bg-yellow-400 text-blue-900 button-hover"
style="display: none;"
>
üèÜ REVEAL PLACES üèÜ
</button>
</div>

<!-- Game Control -->
<div class="pt-4">
<button
id="endGameBtn"
class="w-full magenta-button font-bold py-3 px-4 rounded-xl border-4 shadow-2xl button-hover transition-all transform"
>
üõë END GAME üõë
</button>
</div>
</div>
</div>
</div>

<script>
// Initialize Supabase
const supabaseUrl = 'https://tqpuxtswcuwruaqhompl.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxcHV4dHN3Y3V3cnVhcWhvbXBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NDUyMjQsImV4cCI6MjA3MzEyMTIyNH0.JF71Ap_FJG872iApuXaKW-vNN5TWPiJXvmz6PXWm4cU';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// Game state
let gameActive = false;
let gameCode = '';
let gameId = null;
let allTeams = [];
let buzzedTeams = [];
let scores = {};
let scoresRevealed = false;
let realtimeChannel = null;

// Enhanced sparkle effect
function createSparkle() {
const shapes = ['‚ú¶', '‚Ä¢', '¬∑', '*', '‚úß', '‚ãÜ', '‚ó¶'];
const sparklesContainer = document.getElementById('sparkles');
for(let i = 0; i < 2; i++) {
setTimeout(() => {
const sparkle = document.createElement('div');
sparkle.className = 'sparkle';
sparkle.style.position = 'absolute';
sparkle.style.left = (Math.random() * 90 + 5) + '%';
sparkle.style.top = (Math.random() * 90 + 5) + '%';
sparkle.style.color = 'white';
sparkle.style.fontSize = (Math.random() < 0.4 ? 6 : Math.random() < 0.7 ? 10 : 14) + 'px';
sparkle.style.textShadow = '0 0 4px rgba(255,255,255,0.8)';
sparkle.textContent = shapes[Math.floor(Math.random() * shapes.length)];
sparkle.style.zIndex = '5';
sparklesContainer.appendChild(sparkle);
setTimeout(() => sparkle.remove(), 250);
}, i * 50);
}
}
setInterval(createSparkle, 150);

// Generate secure 6-digit game code
function generateGameCode() {
return Math.floor(100000 + Math.random() * 900000).toString();
}

// Calculate place with tie handling
function calculatePlace(teams, teamScore) {
const sortedScores = [...new Set(teams.map(t => t.score))].sort((a, b) => a - b);
const place = sortedScores.indexOf(teamScore) + 1;
const teamsWithSameScore = teams.filter(t => t.score === teamScore).length;
return { place, isTie: teamsWithSameScore > 1 };
}

// Supabase functions
async function createNewGame() {
gameCode = generateGameCode();
const { data, error } = await supabase
.from('games')
.insert([{
game_code: gameCode,
status: 'active',
created_at: new Date().toISOString()
}])
.select()
.single();

if (error) {
console.error('Error creating game:', error);
alert('Error creating game. Please try again.');
return null;
}
gameId = data.id;
return data;
}

async function loadTeams() {
if (!gameId) return;
const { data, error } = await supabase
.from('teams')
.select('*')
.eq('game_id', gameId)
.order('created_at', { ascending: true });

if (error) {
console.error('Error loading teams:', error);
return;
}

allTeams = data || [];
buzzedTeams = allTeams.filter(team => team.buzzed_at).sort((a, b) => new Date(a.buzzed_at) - new Date(b.buzzed_at));
updateAllDisplays();
}

async function clearBuzzer(teamId) {
const { error } = await supabase
.from('teams')
.update({ buzzed_at: null })
.eq('id', teamId);

if (error) {
console.error('Error clearing buzzer:', error);
return;
}
loadTeams();
}

async function clearAllBuzzers() {
const { error } = await supabase
.from('teams')
.update({ buzzed_at: null })
.eq('game_id', gameId);

if (error) {
console.error('Error clearing all buzzers:', error);
return;
}
loadTeams();
}

async function updateScore(teamId, score) {
scores[teamId] = score;
updateScoringDisplay();
const { error } = await supabase
.from('teams')
.update({ score: parseInt(score) || 0 })
.eq('id', teamId);

if (error) {
console.error('Error updating score:', error);
}
}

async function endGame() {
if (!gameId || !confirm('Are you sure you want to end this game? This will disconnect all players.')) {
return;
}

const { error } = await supabase
.from('games')
.update({ status: 'ended' })
.eq('id', gameId);

if (error) {
console.error('Error ending game:', error);
}

if (realtimeChannel) {
supabase.removeChannel(realtimeChannel);
}

gameActive = false;
gameCode = '';
gameId = null;
allTeams = [];
buzzedTeams = [];
scores = {};
scoresRevealed = false;

document.getElementById('createGameSection').style.display = 'block';
document.getElementById('gameCodeSection').style.display = 'none';
document.getElementById('gameActiveSections').style.display = 'none';
}

// Setup real-time subscriptions
function setupRealtime() {
if (realtimeChannel) {
supabase.removeChannel(realtimeChannel);
}
realtimeChannel = supabase
.channel(`game_${gameId}`)
.on('postgres_changes',
{ event: '*', schema: 'public', table: 'teams', filter: `game_id=eq.${gameId}` },
(payload) => {
console.log('Team change:', payload);
loadTeams();
}
)
.subscribe();
}

// Update displays
function updateAllTeamsDisplay() {
const container = document.getElementById('allTeamsList');
const teamCount = document.getElementById('teamCount');
teamCount.textContent = allTeams.length;

if (allTeams.length === 0) {
container.innerHTML = '<div class="text-purple-200 text-center py-4 italic">No teams joined yet...</div>';
return;
}

const sortedTeams = [...allTeams].sort((a, b) => a.name.localeCompare(b.name));
container.innerHTML = sortedTeams.map(team => `
<div class="team-card p-3 rounded-lg font-bold mb-2 transition-all ${team.buzzed_at ?
'bg-gradient-to-r from-cyan-600 to-cyan-700 text-white shadow-lg transform scale-105' :
'bg-gradient-to-r from-violet-600 to-purple-700 text-purple-100'} shadow-md">
<div class="flex items-center justify-between">
<span>${team.name}</span>
${team.buzzed_at ? '<span class="text-xs animate-pulse">üö® BUZZED</span>' : ''}
</div>
</div>
`).join('');
}

function updateBuzzedTeamsDisplay() {
const container = document.getElementById('buzzedTeamsList');
if (buzzedTeams.length === 0) {
container.innerHTML = '<div class="text-purple-200 text-center py-4 italic">No teams buzzed in yet...</div>';
return;
}

container.innerHTML = buzzedTeams.map((team, index) => `
<div class="flex items-center justify-between bg-gradient-to-r from-cyan-600 to-cyan-700 text-white p-3 rounded-lg mb-2 shadow-lg transform hover:scale-102 transition-all team-card">
<div class="flex items-center space-x-3">
<span class="bg-white text-cyan-600 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-inner">
${index + 1}
</span>
<span class="font-bold">${team.name}</span>
</div>
<button
onclick="clearBuzzer(${team.id})"
class="magenta-button px-3 py-1 rounded-lg text-xs button-hover transition-all transform font-bold border"
>
‚ùå CLEAR
</button>
</div>
`).join('');
}

function updateScoringDisplay() {
const container = document.getElementById('scoringList');
const revealBtn = document.getElementById('revealScoresBtn');
const dramaticSection = document.getElementById('dramaticReadingSection');

if (allTeams.length === 0) {
container.innerHTML = '<div class="text-purple-200 text-center py-4 italic">No teams to score yet...</div>';
revealBtn.style.display = 'none';
return;
}

const sortedTeams = [...allTeams].sort((a, b) => a.name.localeCompare(b.name));
container.innerHTML = sortedTeams.map(team => `
<div class="flex items-center space-x-3 mb-3 p-2 bg-purple-700 rounded-lg glassmorphism">
<div class="flex-1 text-white font-bold text-sm truncate">
${team.name}
</div>
<input
type="number"
id="score_${team.id}"
value="${scores[team.id] !== undefined ? scores[team.id] : (team.score || '')}"
onchange="updateScore(${team.id}, this.value)"
class="w-20 h-10 text-center font-bold bg-gradient-to-r from-violet-600 to-purple-700 text-white border-2 border-yellow-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 transition-all"
placeholder="0"
/>
</div>
`).join('');

allTeams.forEach(team => {
if (scores[team.id] === undefined) {
scores[team.id] = team.score || '';
}
});

const hasScores = Object.values(scores).some(score => score !== '' && score !== null);
if (hasScores) {
revealBtn.style.display = 'block';
dramaticSection.style.display = 'block';

const teamsWithScores = allTeams.map(team => ({
...team,
score: parseInt(scores[team.id]) || team.score || 0
})).sort((a, b) => a.score - b.score);

document.getElementById('dramaticReadingList').innerHTML = teamsWithScores.map(team => {
const { place, isTie } = calculatePlace(teamsWithScores, team.score);
const placeText = isTie ? `${place}${getPlaceSuffix(place)} PLACE - TIE!` : `${place}${getPlaceSuffix(place)} PLACE`;
return `
<div class="flex justify-between text-white text-sm bg-purple-600 p-2 rounded glassmorphism">
<span>${team.name}</span>
<div class="text-right">
<span class="font-bold text-yellow-400">${team.score} pts</span>
<div class="text-xs text-purple-200">${placeText}</div>
</div>
</div>
`;
}).join('');
} else {
revealBtn.style.display = 'none';
dramaticSection.style.display = 'none';
}
}

function getPlaceSuffix(place) {
if (place % 10 === 1 && place !== 11) return 'st';
if (place % 10 === 2 && place !== 12) return 'nd';
if (place % 10 === 3 && place !== 13) return 'rd';
return 'th';
}

function updateAllDisplays() {
updateAllTeamsDisplay();
updateBuzzedTeamsDisplay();
updateScoringDisplay();
}

// Event listeners
document.getElementById('createGameBtn').addEventListener('click', async function() {
const gameData = await createNewGame();
if (!gameData) return;

gameActive = true;
document.getElementById('gameCodeDisplay').textContent = gameCode;
document.getElementById('createGameSection').style.display = 'none';
document.getElementById('gameCodeSection').style.display = 'block';
document.getElementById('gameActiveSections').style.display = 'block';

setupRealtime();
loadTeams();
});

document.getElementById('clearAllBtn').addEventListener('click', clearAllBuzzers);

document.getElementById('revealScoresBtn').addEventListener('click', function() {
scoresRevealed = true;
this.textContent = 'üéâ PLACES REVEALED! üéâ';
this.className = 'w-full mt-4 py-3 px-4 text-lg font-bold rounded-xl border-4 border-yellow-400 shadow-2xl cursor-default bg-cyan-600 text-white';

try {
new Audio('fanfare.mp3').play().catch(() => {});
} catch (e) {}
});

document.getElementById('endGameBtn').addEventListener('click', endGame);

// Make functions global
window.clearBuzzer = clearBuzzer;
window.updateScore = updateScore;
</script>
</body>
</html>
